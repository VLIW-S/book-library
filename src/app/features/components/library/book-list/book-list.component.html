<div class="container">
  <app-header
    [title]="'Book Library'"
    [actionLink]="['/library/add']"
    [actionLabel]="'Add New Book'"
  />
  @if (isLoading()) {
  <div class="table-wrapper">
    <div class="loading-overlay">
      <p>Loading books...</p>
      <mat-spinner></mat-spinner>
    </div>
  </div>
  } @if (error()) {
  <p class="error-message">Error: {{ error() }}</p>
  } @if (!isLoading() && !error() && bookCount() > 0) {

  <mat-form-field class="search">
    <mat-label>Filter</mat-label>
    <input matInput (keyup)="applyFilter($event)" placeholder="Searching..." #input />
  </mat-form-field>

  <div class="table-wrapper">
    <table class="table" mat-table [dataSource]="dataSource" class="mat-elevation-z8">
      <!-- Title -->
      <ng-container matColumnDef="title">
        <th mat-header-cell *matHeaderCellDef>Title</th>
        <td mat-cell *matCellDef="let element">{{ element.title }}</td>
      </ng-container>

      <!-- Author -->
      <ng-container matColumnDef="author">
        <th mat-header-cell *matHeaderCellDef>Author</th>
        <td mat-cell *matCellDef="let element">{{ element.author }}</td>
      </ng-container>

      <!-- Year -->
      <ng-container matColumnDef="year">
        <th mat-header-cell *matHeaderCellDef>Year</th>
        <td mat-cell *matCellDef="let element">{{ element.year }}</td>
      </ng-container>

      <!-- Genre -->
      <ng-container matColumnDef="genre">
        <th mat-header-cell *matHeaderCellDef>Genre</th>
        <td mat-cell *matCellDef="let element">{{ element.genre }}</td>
      </ng-container>

      <!-- Actions -->
      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef>Actions</th>
        <td mat-cell *matCellDef="let element">
          <button
            matButton
            [routerLink]="['/library/edit', element.id]"
            aria-label="Edit book {{ element.title }}"
          >
            <mat-icon>edit</mat-icon> Edit
          </button>
          <button
            matButton
            (click)="deleteBook(element)"
            aria-label="Delete book {{ element.title }}"
          >
            <mat-icon>delete</mat-icon> Delete
          </button>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>

      <!-- No matching data -->
      <tr class="mat-row" *matNoDataRow>
        <td class="mat-cell" colspan="5">No data matching the filter "{{ input.value }}"</td>
      </tr>
    </table>
  </div>

  <!-- Pagination -->
  <app-pagination
    [items]="sortedBooks()"
    [pageSize]="5"
    (pageChange)="onPageChange($event)"
  ></app-pagination>

  } @else if (!isLoading() && !error() && bookCount() === 0) {
  <p class="no-books">No books found. Why not add one?</p>
  }
</div>
